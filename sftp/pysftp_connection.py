import base64
import os
import pysftp

hostname = "sftp-int.mercadolibre.io"
username = "jrimmele_mp_prod"
ssh_key_b64 = "YjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQ21GbGN6STFOaTFqZEhJQUFBQUdZbU55ZVhCMEFBQUFHQUFBQUJCWWZ3cDMyRwo1cXNsZ2tQSStwcXJkQ0FBQUFHQUFBQUFFQUFBRVhBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCQVFEVC9Lcm91S0g1CkdwUmFqYW1nUUFnRVpkeFBVY2RJdm5scjUreDhCQU4xb2dhcXZEVGlMUVovL1JQSk02eUpiRmdVb0hoSTVKanhSYUxVbjcKZHJPZGt1WGhzVmJ6UUpaVkF4Q0txMlU4UlRCWlp3YmVoTmdSaVEwQWtacjJkeGx6WTdJcU5oZzNmeEVSdHc4dXRjc3I3MQpLNnVyWTFxekRIZG1wWjdiZ3FhUHZjRktDbTEwQk44di94ZHRMVFlNTjVHc04xdDh3dHljOHpNenp3OVZTYlFoVFI0RzdtCjBxcUE5RUJtMFJyc25oNGlSOWE5bk50ZzRuSkV3VVVZdDVMdk1zbWdFV1NNTzgyZW9DZHhnNFVkbStVVUE5THRjVzJRRmcKYjJESmZSZEFwQXBkaEZNZ25Cc2t1MUlQdjREL2R5WkJCSmdYd3gvUEdCVVgwV0xvZ2VaTkFBQUQ0TkhNeFBWb0pSZXJlYQplVlhWSUVXelNrbjhESHJUM1RnQ1hxRHRTTUE4ZnZvT3FTYnBtQW96UUdQeklzZ1JvdG9wOTBIdjI3SVVsUVBnTUVTdFBUCkZQZzJDRHJpYnUxblJ4Vk5SbVhaem8wTCtXall6UEdXYTBKRHlFbXh0VVpyUXZoSE9qbm1xOTNFYUhjT2lmR0hnZmdCSXIKR2lYTVFKaUFYQWdBNldsQ0F1WUlvQU1DQTU5QTN3dll3RGI1emRFNEV3WVBwMk1wT2IwOVVQUS85RlBIUUxUa2wrMGxWRgpoK1R0cjdueGlsU00rWlpEd0RTUG9rQWpRWjRGQlNhc2JXSnNtVis3cEgvNVRHZm5TR1RIOVkveWYydGwyczBMMWRUd0UxCnZXMkdEVjhma0w1RE9XT2l1QU1RT3BqQmplMFBQMndtZnpxN0VtUkNURWU1SGhYbDQyRTFJdmNXazhUMHR3bm1Ic09XeVAKaXBBeFlYV0ZkR25ybis0RStiTkZMSldXWDFBWndyY09HV3c5NjhmSGF0UG9UWklxMUhaK0hQei9zd1c0Z3ZhSnVFQVZkcQpGYWVkYk5aZStjTXpaWFllZTAzdEswTXBzUHVNaFNWTjh4MVcyVk1ZRVdyOXVibGFzUmJxYU9VUEFNRktRUHN1bG91ZkpsCnJHRXpxSEluTlV6dW1ZUVBGMUNWM2pXcE1RQStKSldnSEpVNlY3bkI2dWhCZWhDNjVaOGJrZmhxQVJQRjhXZ0V0bTFwTXcKTFJOSmN3ZCtCUWp4dHpiQTlnRE0wd1ZxK0tNeEtIMGFFZHhiL2IwalVSYjNmbEZPT0doWjMxbzVWWDVPMjFlUXdBaHVVUwpnL1RYaUU2N2dXRS85N3A4MDcwMzZ1RElqZkt2ODEyRG0xMWlJdXBRVkZhUXV1L1ZzNXJQMXhUQ3FxbmFrcWREVU1LdHR6Ci93OEdHZXczRjJab1JuanhqMVZoY0Nmd211YWNNYmNDZm5UbEx2QmFCUEZXcGdKZGJzb0ZKWVV4VEd6Rmp6OGlyb2FHWXUKVm0rWWNtMEVsNGdTQUh0YjJTcU5HS3M0emFxZk56R2M0dWdHTFRCeXN2cXJ5YUNNRmRYSU51RmcxaFFmV1ZqSU1pbCtMcgp5OWpVcHZITkgrcEhxQWUxUCtqMmkzYk5lc2VFUDdETVpvNHcyK3JUcnN3L0FsaTlGOVFHdUFYSU5HRFNNWlZvNlNTTi9mCmVFeFY3THZnMFNEUkt1RG9NbzAzek5nV1l4TWlhaW52QkdtZ3dQRTd2VVF2RnJ6UFd2YUNQUk9RQ0hIMFhlekVpa2kxbWkKOHZ6TDFBeEFUVjhjNUhsRVJ3VXdxUDFIZWdVYnZXa3VzODhXT2ZWRmhjT1FibmtrVHNRM3I1TlBPbUxQZWNqV0pFODBKawpZOEdmejR3MFgwZUlYSWs4VXFrdjlmRmJXWUNJSjF3ZFRQYkcvbWhkQk9JMkRjOU1IVitQUW9GSlp3YXJXcHdWQnI5UVZVCkp5STBDcFR1YlhIUTZSek5PN1pibWRpSEV4MmI5eHZNdy9XTWdzeVAyODJyaGMyWTFoVXZFcUltWDRqUnlzRnphYXg0QWkKS2lwNEkycUYzdGx0Q1hMN1o1Q3ZFcktXQTZabkhsRFUzMzg4dlBxL3Vqak90cHJ3azhsUWFpMmw5US9ibEZ0NWc0TGF4ZwpTTXAvTm9vQ0w5Umpzb01FYjBSQTl4NFY2N3ZHdHRyT3NZZXptdzZjM2MxQnJUSHQveQ=="
ssh_secret = "juanmartin123"

# Guardar temporal la clave
key_path = "/tmp/temp_key"
with open(key_path, "w") as f:
    f.write(base64.b64decode(ssh_key_b64).decode("utf-8"))
os.chmod(key_path, 0o600)

cnopts = pysftp.CnOpts()
cnopts.hostkeys = None  # solo para debug (no recomendado en prod)

with pysftp.Connection(
    host=hostname,
    username=username,
    private_key=key_path,
    private_key_pass=ssh_secret,
    port=22,
    cnopts=cnopts
) as sftp:
    print("âœ… Conectado")
    print("Archivos:", sftp.listdir("/ml-sftp/mp_prod/reconciliations/simetrik-v2/transfers/mlu/urutec"))
